# 不確かさ計算ツール

## 概要
このツールは、測定値の不確かさを計算するためのGUIアプリケーションです。複数の測定値から計算される結果の不確かさを、GUM法（Guide to the Expression of Uncertainty in Measurement）に基づいて計算します。

## 主な機能
1. モデル方程式の入力と管理
2. 測定値と不確かさの入力
3. 感度係数の自動計算
4. 不確かさの伝播計算
5. 結果の表示とエクスポート

## システム要件
- Python 3.8以上
- PyQt5 (GPLまたは商用ライセンス)
- NumPy (BSDライセンス)
- SymPy (BSDライセンス)

## インストール方法
1. リポジトリをクローン
```bash
git clone [repository-url]
```

2. 依存パッケージのインストール
```bash
pip install -r requirements.txt
```

3. アプリケーションの起動
```bash
python src/main.py
```

## プロジェクト構造
```
src/
├── main.py              # メインアプリケーション
├── tabs/               # タブ関連のモジュール
│   ├── model_equation_tab.py    # モデル方程式入力タブ
│   ├── uncertainty_calculation_tab.py  # 不確かさ計算タブ
│   └── variables_tab.py        # 変数管理タブ
└── utils/              # ユーティリティモジュール
    └── equation_formatter.py   # 数式フォーマッター
```

## 計算の背景と根拠

### 1. 不確かさの伝播法則
GUM法に基づき、以下の不確かさの伝播法則を使用して計算を行います：
ただし現時点では相関不確かさについての計算は実装していません。
モデル式の時点で相関がないよう考慮してください。

```
u²(y) = Σ(∂f/∂xᵢ)²u²(xᵢ) + 2ΣΣ(∂f/∂xᵢ)(∂f/∂xⱼ)u(xᵢ,xⱼ)
```

ここで：
- u(y): 計算結果の不確かさ
- ∂f/∂xᵢ: 感度係数
- u(xᵢ): 入力変数の不確かさ
- u(xᵢ,xⱼ): 相関不確かさ

### 2. 感度係数の計算
感度係数は、モデル方程式の各入力変数に関する偏微分として計算されます：

```
∂f/∂xᵢ = lim(Δxᵢ→0) [f(x₁,...,xᵢ+Δxᵢ,...,xₙ) - f(x₁,...,xᵢ,...,xₙ)] / Δxᵢ
```

#### 連立方程式の場合
連立方程式の場合は、連鎖律（chain rule）を使用して感度係数を計算します：

```
∂W/∂x = (∂W/∂V)(∂V/∂x) + (∂W/∂I)(∂I/∂x)
```

例：
- W = V * I / R
- V = V_MEAS + V_CAL
- I = I_MEAS + I_CAL

この場合：
1. ∂W/∂V_MEAS = (∂W/∂V)(∂V/∂V_MEAS) = (I/R)(1) = I/R
2. ∂W/∂V_CAL = (∂W/∂V)(∂V/∂V_CAL) = (I/R)(1) = I/R
3. ∂W/∂I_MEAS = (∂W/∂I)(∂I/∂I_MEAS) = (V/R)(1) = V/R
4. ∂W/∂I_CAL = (∂W/∂I)(∂I/∂I_CAL) = (V/R)(1) = V/R
5. ∂W/∂R = -V*I/R²

### 3. 不確かさの種類
1. A類不確かさ（統計的手法による評価）
   - 標準偏差
   - 自由度

2. B類不確かさ（統計的手法以外による評価）
   - 矩形分布
   - 三角分布
   - 正規分布

### 4. 自由度の計算
Welch-Satterthwaiteの式を使用して有効自由度を計算：
自由度が入力されていない場合、自由度は∞として扱われます。
```
νeff = u⁴(y) / Σ[u⁴(xᵢ) / νᵢ]
```

### 5. 拡張不確かさの計算
包含係数k（通常k=2）を使用して拡張不確かさを計算：

```
U = k * u(y)
```

## 使用方法
1. モデル方程式の入力
   - 計算式を入力（例：W = V * I / R）
   - 複数の方程式はカンマで区切って入力可能

2. 変数の設定
   - 各変数の値を入力
   - 不確かさの種類と値を設定
   - 相関の有無を設定

3. 計算の実行
   - 「計算実行」ボタンをクリック
   - 結果が表示される

4. 結果の確認
   - 感度係数
   - 不確かさの寄与
   - 拡張不確かさ

## 注意事項
- 入力値は有効数字に注意して入力してください
- 不確かさの値は適切な単位で入力してください
- 相関がある場合は、相関係数を適切に設定してください

## ライセンス

このソフトウェアは GNU General Public License version 3（GPLv3）の下で公開されています。  
自由に使用、複製、変更、再配布することができますが、再配布する際は **同じGPLv3ライセンス**で行う必要があります。  
詳細なライセンス条件については、同梱の `LICENSE` ファイルをご覧ください。

### 使用している外部ライブラリとライセンス

本ソフトウェアは以下の外部ライブラリに依存しています（いずれも再配布は行っていません）：

| ライブラリ | ライセンス | 備考 |
|------------|------------|------|
| PyQt5      | GPLv3       | 利用者にて別途インストールが必要です |
| NumPy      | BSD（3条項）| pip により自動インストールされます |
| SymPy      | BSD（3条項）| 同上 |

各ライブラリのライセンスについては、各プロジェクトの公式サイトまたは PyPI ページをご参照ください。

各ライブラリのライセンス条文および著作権表示は `third_party_licenses/` ディレクトリにあります。
